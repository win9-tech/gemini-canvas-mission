<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ìœ„ë°”ìœ„ë³´ì˜ ì‹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            font-family: 'Jua', sans-serif;
            background-color: #f8fafc;
            touch-action: manipulation;
            user-select: none;
        }

        .game-card {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-radius: 2.5rem;
        }

        .choice-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .choice-btn:active:not(:disabled) {
            transform: scale(0.9);
        }

        @keyframes coin-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); color: #f59e0b; }
            100% { transform: scale(1); }
        }
        .coin-animation { animation: coin-pop 0.5s ease-out; }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up { animation: slide-up 0.4s ease-out; }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-10px, 0); }
            20%, 40%, 60%, 80% { transform: translate(10px, 0); }
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }

        .wrath-bg {
            background: linear-gradient(rgba(255,0,0,0.2), rgba(0,0,0,0.95));
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

<div id="app" class="w-full max-w-md bg-white game-card p-8 relative overflow-hidden border border-gray-100 min-h-[600px] flex flex-col">

    <!-- Top Info Bar -->
    <div id="top-bar" class="flex justify-between items-start mb-8">
        <div class="bg-blue-50 px-4 py-2 rounded-2xl border border-blue-100">
            <p class="text-[10px] text-blue-400 uppercase tracking-wider">Best Record</p>
            <p class="text-2xl text-blue-600" id="best-score">0ìŠ¹</p>
        </div>
        <div class="text-right bg-yellow-50 px-4 py-2 rounded-2xl border border-yellow-100">
            <p class="text-[10px] text-yellow-600 uppercase tracking-wider">My Coins</p>
            <div class="flex items-center justify-end">
                <i class="fas fa-coins text-yellow-500 mr-2"></i>
                <span class="text-2xl text-yellow-700" id="current-coins">30</span>
            </div>
        </div>
    </div>

    <!-- Section Containers -->
    <div class="flex-grow flex flex-col justify-center">

        <!-- Main Menu -->
        <div id="main-menu" class="text-center py-6 animate-slide-up">
            <div class="mb-6 inline-block p-4 bg-yellow-400 rounded-full shadow-inner">
                <span class="text-6xl">ğŸ‘‘</span>
            </div>
            <h1 class="text-5xl font-extrabold mb-2 text-gray-800 tracking-tight">ê°€ìœ„ë°”ìœ„ë³´ì˜ ì‹ </h1>
            <p class="text-gray-400 mb-10">ì‹ ì˜ ë¶„ë…¸ë¥¼ í”¼í•´ ìŠ¹ë¦¬ë¥¼ ìŸì·¨í•˜ì„¸ìš”!</p>

            <div class="flex flex-col gap-4">
                <button onclick="startGame()" class="group relative bg-blue-600 hover:bg-blue-700 text-white text-2xl py-5 rounded-3xl shadow-xl transition-all overflow-hidden">
                    <span class="relative z-10">ê²Œì„ ì‹œì‘ <span class="text-sm opacity-80">(2ì½”ì¸)</span></span>
                    <div class="absolute inset-0 bg-white/10 translate-y-full group-hover:translate-y-0 transition-transform"></div>
                </button>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="openShop()" class="bg-amber-100 hover:bg-amber-200 text-amber-800 py-4 rounded-2xl font-bold transition-all">
                        <i class="fas fa-shopping-bag mr-2"></i>ì¥ê°‘ ìƒì 
                    </button>
                    <button onclick="toggleModal('guide-modal')" class="bg-gray-100 hover:bg-gray-200 text-gray-600 py-4 rounded-2xl font-bold transition-all">
                        <i class="fas fa-info-circle mr-2"></i>ê²Œì„ ë°©ë²•
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden text-center animate-slide-up h-full flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-2">
                    <span class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs font-bold">STREAK</span>
                    <span id="current-streak" class="text-2xl text-gray-800 font-bold">0</span>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-red-400 font-bold">WRATH RISK</p>
                    <div class="flex items-center justify-end space-x-1">
                        <i class="fas fa-shield-alt text-[10px] text-blue-400" id="shield-icon"></i>
                        <p id="wrath-percent" class="text-sm text-red-500 font-bold">1.0%</p>
                    </div>
                </div>
            </div>

            <!-- Computer Area -->
            <div id="com-area" class="bg-gray-50 rounded-3xl p-8 mb-6 border border-dashed border-gray-200 relative transition-colors duration-500">
                <div id="com-hand" class="text-8xl mb-2 transition-all duration-300 filter drop-shadow-md">â“</div>
                <p id="com-subtext" class="text-gray-400 text-sm">ì‹ ì˜ ëŒ€ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</p>
                <div id="reward-pop" class="absolute -top-4 left-1/2 -translate-x-1/2 bg-yellow-400 text-white px-4 py-1 rounded-full text-sm font-bold opacity-0 transition-all">
                    +5 Coins!
                </div>
            </div>

            <div id="result-text" class="h-14 text-2xl font-black mb-6 flex items-center justify-center text-gray-700">
                ì–´ë–¤ ê²ƒì„ ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?
            </div>

            <!-- Choice Area -->
            <div id="choice-area" class="grid grid-cols-3 gap-4 mb-4">
                <button onclick="play('scissors')" class="choice-btn bg-white border-2 border-gray-100 p-5 rounded-3xl shadow-sm hover:border-blue-400">
                    <span class="text-5xl block mb-2">âœŒï¸</span>
                    <span class="text-sm text-gray-400 font-bold">ê°€ìœ„</span>
                </button>
                <button onclick="play('rock')" class="choice-btn bg-white border-2 border-gray-100 p-5 rounded-3xl shadow-sm hover:border-blue-400">
                    <span class="text-5xl block mb-2">âœŠ</span>
                    <span class="text-sm text-gray-400 font-bold">ë°”ìœ„</span>
                </button>
                <button onclick="play('paper')" class="choice-btn bg-white border-2 border-gray-100 p-5 rounded-3xl shadow-sm hover:border-blue-400">
                    <span class="text-5xl block mb-2">âœ‹</span>
                    <span class="text-sm text-gray-400 font-bold">ë³´</span>
                </button>
            </div>

            <!-- In-game Utilities -->
            <div id="ingame-back-area" class="mb-8">
                <button onclick="quitGame()" class="text-gray-400 hover:text-red-500 text-sm font-bold transition-colors">
                    <i class="fas fa-arrow-left mr-1"></i> í¬ê¸°í•˜ê³  ë©”ì¸ìœ¼ë¡œ
                </button>
            </div>

            <!-- After Result Actions -->
            <div id="next-action-area" class="hidden mb-8 space-y-3">
                <button id="retry-btn" class="w-full bg-blue-600 text-white py-5 rounded-3xl text-xl font-bold shadow-lg hover:bg-blue-700 active:scale-95 transition-all">
                    í•œ íŒ ë”!
                </button>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="openShop()" class="bg-amber-100 text-amber-800 py-3 rounded-2xl font-bold text-sm hover:bg-amber-200 transition-all">
                        <i class="fas fa-shopping-bag mr-1"></i> ìƒì ê°€ê¸°
                    </button>
                    <button onclick="quitGame()" class="bg-gray-100 text-gray-600 py-3 rounded-2xl font-bold text-sm hover:bg-gray-200 transition-all">
                        ê·¸ë§Œí•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- Bottom Equipment Info -->
            <div class="mt-auto bg-gradient-to-r from-blue-600 to-indigo-600 p-4 rounded-3xl text-white shadow-lg">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span id="equipped-icon" class="text-2xl mr-3">ğŸ–ï¸</span>
                        <div class="text-left">
                            <p class="text-[10px] opacity-70 leading-none">EQUIPPED</p>
                            <p class="font-bold text-sm" id="equipped-glove-name">ê¸°ë³¸ ì†</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] opacity-70 leading-none">ABILITY</p>
                        <p class="font-bold text-xs text-yellow-300">ìŠ¹ë¥ +<span id="equipped-win-rate">0</span>% / ë¦¬ìŠ¤í¬-<span id="equipped-resist">0</span>%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Wrath Screen -->
    <div id="wrath-screen" class="hidden absolute inset-0 z-[100] wrath-bg flex flex-col items-center justify-center text-center p-8 animate-slide-up">
        <span class="text-8xl mb-6">âš¡âš¡âš¡</span>
        <h2 class="text-5xl font-black text-red-500 mb-4 leading-tight">ì‹ ì˜ ë¶„ë…¸!</h2>
        <p class="text-white text-lg mb-8 leading-relaxed">ì‹ ì˜ ì¸ë‚´ì‹¬ì´ ë°”ë‹¥ë‚¬ìŠµë‹ˆë‹¤.<br>íŒì´ ì—ì–´ì ¸ ëª¨ë“  ì½”ì¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤.</p>
        <button onclick="resetApp()" class="w-full bg-white text-red-600 py-5 rounded-3xl text-xl font-bold shadow-2xl hover:bg-gray-100 transition-all">
            ìš´ëª…ì„ ë‹¤ì‹œ ì‹œí—˜í•˜ê¸°
        </button>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over" class="hidden text-center py-10 animate-slide-up flex-grow flex flex-col justify-center">
        <span class="text-6xl mb-6 block">ğŸ’¸</span>
        <h2 class="text-4xl font-black text-red-500 mb-2">ì˜¬ì¸... íŒŒì‚°í–ˆìŠµë‹ˆë‹¤</h2>
        <p class="text-gray-500 mb-10 leading-relaxed">ì½”ì¸ì´ ì „ë¶€ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì‹ ì˜ ìë¹„ë¡œ ì´ˆê¸° ìë³¸ì„ ë“œë¦½ë‹ˆë‹¤.</p>
        <button onclick="resetApp()" class="w-full bg-gray-800 text-white py-5 rounded-3xl text-xl font-bold shadow-xl hover:bg-black transition-all">
            30ì½”ì¸ ì¶©ì „í•˜ê³  ë¶€í™œí•˜ê¸°
        </button>
    </div>

</div>

<!-- Modals -->
<div id="guide-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-6 z-[200] backdrop-blur-sm">
    <div class="bg-white rounded-[2.5rem] p-8 w-full max-w-xs text-center shadow-2xl animate-slide-up">
        <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-bolt text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold mb-4">ê²Œì„ ê°€ì´ë“œ</h3>
        <ul class="text-left text-gray-500 space-y-3 mb-8 text-sm">
            <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>íŒë‹¹ 2ì½”ì¸ì´ ì†Œëª¨ë©ë‹ˆë‹¤.</li>
            <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i><strong>ë¬´ìŠ¹ë¶€</strong>ì‹œ ê²©ë ¤ê¸ˆ 1ì½”ì¸ì„ ë“œë¦½ë‹ˆë‹¤.</li>
            <li class="flex items-start"><i class="fas fa-shield-alt text-blue-500 mt-1 mr-2"></i><strong>ì¥ê°‘ íš¨ê³¼</strong>: ì¢‹ì€ ì¥ê°‘ì€ ìŠ¹ë¥ ì„ ë†’ì´ê³  ì‹ ì˜ ë¶„ë…¸ë¥¼ ê²¬ë””ëŠ” í˜ì„ ì¤ë‹ˆë‹¤.</li>
            <li class="flex items-start"><i class="fas fa-chart-line text-red-500 mt-1 mr-2"></i>ì—°ìŠ¹ì´ ê¸¸ì–´ì§ˆìˆ˜ë¡ ë¶„ë…¸ í™•ë¥ ì´ ë†’ì•„ì§€ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”!</li>
        </ul>
        <button onclick="toggleModal('guide-modal')" class="w-full bg-blue-600 text-white py-3 rounded-2xl font-bold">ì•Œê² ì–´ìš”!</button>
    </div>
</div>

<div id="shop-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-6 z-[200] backdrop-blur-sm">
    <div class="bg-white rounded-[2.5rem] p-8 w-full max-w-sm shadow-2xl animate-slide-up">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-3xl font-black text-gray-800">ì¥ê°‘ ìƒì </h3>
            <button onclick="toggleModal('shop-modal')" class="text-gray-300 hover:text-gray-500"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div id="shop-items" class="space-y-4 max-h-[50vh] overflow-y-auto pr-2 custom-scrollbar">
            <!-- Items Render Here -->
        </div>
    </div>
</div>

<script>
    let state = {
        coins: 30,
        bestScore: 0,
        currentStreak: 0,
        equippedGloveId: 0,
        ownedGloves: [0],
        inventory: [
            { id: 0, name: "í‰ë²”í•œ ì†", price: 0, icon: "ğŸ–ï¸", winRate: 33, wrathResistance: 0 },
            { id: 1, name: "í–‰ìš´ì˜ íŒ”ì°Œ", price: 15, icon: "ğŸ“¿", winRate: 40, wrathResistance: 10 },
            { id: 2, name: "ë¹¨ê°„ ëª©ì¥ê°‘", price: 40, icon: "ğŸ§¤", winRate: 50, wrathResistance: 25 },
            { id: 3, name: "ê°•ì²  ë„ˆí´", price: 100, icon: "ğŸ¥Š", winRate: 65, wrathResistance: 45 },
            { id: 4, name: "ë¯¸ë‹¤ìŠ¤ì˜ ì†", price: 300, icon: "âœ¨", winRate: 85, wrathResistance: 70 }
        ]
    };

    const hands = {
        rock: { icon: "âœŠ", beats: "scissors", losesTo: "paper" },
        scissors: { icon: "âœŒï¸", beats: "paper", losesTo: "rock" },
        paper: { icon: "âœ‹", beats: "rock", losesTo: "scissors" }
    };

    window.onload = () => {
        const saved = localStorage.getItem('rps_god_v3_data');
        if (saved) {
            const parsed = JSON.parse(saved);
            state.bestScore = parsed.bestScore || 0;
            state.coins = parsed.coins !== undefined ? parsed.coins : 30;
            state.ownedGloves = parsed.ownedGloves || [0];
            state.equippedGloveId = parsed.equippedGloveId || 0;
        }
        updateUI();
    };

    function saveGame() {
        localStorage.setItem('rps_god_v3_data', JSON.stringify({
            bestScore: state.bestScore,
            coins: state.coins,
            ownedGloves: state.ownedGloves,
            equippedGloveId: state.equippedGloveId
        }));
    }

    function calculateWrathProb() {
        const baseProb = 1.0;
        const perStreak = 0.5;
        const glove = state.inventory.find(g => g.id === state.equippedGloveId);
        const resistanceFactor = (100 - glove.wrathResistance) / 100;
        const reducedRisk = baseProb + (state.currentStreak * perStreak * resistanceFactor);
        return Math.max(1.0, reducedRisk);
    }

    function updateUI() {
        document.getElementById('best-score').innerText = `${state.bestScore}ìŠ¹`;
        document.getElementById('current-coins').innerText = state.coins;
        document.getElementById('current-streak').innerText = state.currentStreak;

        const currentRisk = calculateWrathProb();
        document.getElementById('wrath-percent').innerText = `${currentRisk.toFixed(1)}%`;

        const glove = state.inventory.find(g => g.id === state.equippedGloveId);
        document.getElementById('equipped-glove-name').innerText = glove.name;
        document.getElementById('equipped-icon').innerText = glove.icon;
        document.getElementById('equipped-win-rate').innerText = Math.round(itemWinBonus(glove));
        document.getElementById('equipped-resist').innerText = glove.wrathResistance;

        const shield = document.getElementById('shield-icon');
        if(glove.wrathResistance > 0) {
            shield.style.display = 'inline-block';
            shield.style.opacity = 0.3 + (glove.wrathResistance / 100);
        } else {
            shield.style.display = 'none';
        }
    }

    function itemWinBonus(glove) {
        return Math.round(glove.winRate - 33);
    }

    function toggleModal(id) {
        const modal = document.getElementById(id);
        modal.classList.toggle('hidden');
        modal.classList.toggle('flex');
    }

    function hideAllScreens() {
        document.getElementById('main-menu').classList.add('hidden');
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('game-over').classList.add('hidden');
        document.getElementById('wrath-screen').classList.add('hidden');
    }

    function startGame() {
        if (state.coins < 2) {
            hideAllScreens();
            document.getElementById('game-over').classList.remove('hidden');
            return;
        }
        state.coins -= 2;
        state.currentStreak = 0;
        updateUI();
        hideAllScreens();
        document.getElementById('game-screen').classList.remove('hidden');
        prepareNextRound();
    }

    function prepareNextRound() {
        document.getElementById('result-text').innerText = "ì–´ë–¤ ê²ƒì„ ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?";
        document.getElementById('result-text').className = "h-14 text-2xl font-black mb-6 flex items-center justify-center text-gray-700";
        document.getElementById('com-hand').innerText = "â“";
        document.getElementById('com-subtext').innerText = "ì‹ ì˜ ëŒ€ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...";
        document.getElementById('com-area').className = "bg-gray-50 rounded-3xl p-8 mb-6 border border-dashed border-gray-200 relative transition-colors duration-500";
        document.getElementById('choice-area').classList.remove('hidden');
        document.getElementById('ingame-back-area').classList.remove('hidden');
        document.getElementById('next-action-area').classList.add('hidden');
    }

    function play(userChoice) {
        const currentRisk = calculateWrathProb() / 100;
        if (Math.random() < currentRisk) {
            triggerWrath();
            return;
        }
        const glove = state.inventory.find(g => g.id === state.equippedGloveId);
        const winProbability = glove.winRate / 100;
        const roll = Math.random();
        let result;
        let comChoice;
        if (roll < winProbability) {
            result = 'win';
            comChoice = hands[userChoice].beats;
        } else if (roll < winProbability + 0.15) {
            result = 'draw';
            comChoice = userChoice;
        } else {
            result = 'lose';
            comChoice = hands[userChoice].losesTo;
        }
        const comHandEl = document.getElementById('com-hand');
        const resultEl = document.getElementById('result-text');
        comHandEl.innerText = hands[comChoice].icon;
        document.getElementById('choice-area').classList.add('hidden');
        document.getElementById('ingame-back-area').classList.add('hidden');
        document.getElementById('next-action-area').classList.remove('hidden');
        if (result === 'draw') {
            state.coins += 1;
            resultEl.innerText = "ë¬´ìŠ¹ë¶€! +1ì½”ì¸ ì„œë¹„ìŠ¤";
            resultEl.className = "h-14 text-2xl font-black mb-6 flex items-center justify-center text-gray-500";
            document.getElementById('retry-btn').innerText = "ì¬ë„ì „ (ë¬´ë£Œ)";
        } else if (result === 'win') {
            state.currentStreak++;
            const reward = 5 + (state.currentStreak * 2);
            state.coins += reward;
            resultEl.innerText = `ìŠ¹ë¦¬! +${reward}ì½”ì¸ íšë“`;
            resultEl.className = "h-14 text-2xl font-black mb-6 flex items-center justify-center text-blue-600";
            document.getElementById('retry-btn').innerText = "ë‹¤ìŒ íŒ (2ì½”ì¸ ì†Œëª¨)";
            showRewardPop(`+${reward} Coins!`);
            if (state.currentStreak > state.bestScore) state.bestScore = state.currentStreak;
        } else {
            resultEl.innerText = "íŒ¨ë°°.. ì—°ìŠ¹ì´ ëŠê²¼ìŠµë‹ˆë‹¤";
            resultEl.className = "h-14 text-2xl font-black mb-6 flex items-center justify-center text-red-500";
            state.currentStreak = 0;
            document.getElementById('retry-btn').innerText = "ë‹¤ì‹œ ë„ì „ (2ì½”ì¸ ì†Œëª¨)";
        }
        document.getElementById('current-coins').parentElement.classList.add('coin-animation');
        setTimeout(() => {
            document.getElementById('current-coins').parentElement.classList.remove('coin-animation');
        }, 500);
        document.getElementById('retry-btn').onclick = () => {
            if (result === 'draw') {
                prepareNextRound();
            } else {
                if (state.coins >= 2) {
                    state.coins -= 2;
                    updateUI();
                    saveGame();
                    prepareNextRound();
                } else {
                    hideAllScreens();
                    document.getElementById('game-over').classList.remove('hidden');
                }
            }
        };
        updateUI();
        saveGame();
    }

    function triggerWrath() {
        const app = document.getElementById('app');
        const comArea = document.getElementById('com-area');
        const comSub = document.getElementById('com-subtext');
        const comHand = document.getElementById('com-hand');
        app.classList.add('shake');
        comArea.classList.replace('bg-gray-50', 'bg-red-500');
        comHand.innerText = "ğŸ˜¡";
        comSub.innerText = "ì‹ ì´ ë¶„ë…¸í–ˆìŠµë‹ˆë‹¤!!!";
        comSub.className = "text-white text-sm font-bold";
        document.getElementById('choice-area').classList.add('hidden');
        document.getElementById('ingame-back-area').classList.add('hidden');
        document.getElementById('next-action-area').classList.add('hidden');
        setTimeout(() => {
            state.coins = 0;
            state.currentStreak = 0;
            updateUI();
            saveGame();
            hideAllScreens();
            document.getElementById('wrath-screen').classList.remove('hidden');
            app.classList.remove('shake');
        }, 1000);
    }

    function showRewardPop(text) {
        const pop = document.getElementById('reward-pop');
        pop.innerText = text;
        pop.classList.replace('opacity-0', 'opacity-100');
        pop.style.transform = 'translate(-50%, -20px)';
        setTimeout(() => {
            pop.classList.replace('opacity-100', 'opacity-0');
            pop.style.transform = 'translate(-50%, 0)';
        }, 1000);
    }

    function quitGame() {
        state.currentStreak = 0;
        hideAllScreens();
        document.getElementById('main-menu').classList.remove('hidden');
        updateUI();
    }

    function resetApp() {
        state.coins = 30;
        state.currentStreak = 0;
        updateUI();
        saveGame();
        hideAllScreens();
        document.getElementById('main-menu').classList.remove('hidden');
    }

    function openShop() {
        const shopContainer = document.getElementById('shop-items');
        shopContainer.innerHTML = '';

        state.inventory.forEach(item => {
            const isOwned = state.ownedGloves.includes(item.id);
            const isEquipped = state.equippedGloveId === item.id;
            const winBonus = Math.round(item.winRate - 33);

            const div = document.createElement('div');
            div.className = `flex items-center justify-between p-4 rounded-3xl border-2 transition-all ${isEquipped ? 'border-blue-500 bg-blue-50' : 'border-gray-50 bg-gray-50'}`;

            // Button Class Logic:
            // 1. Not owned: Yellow (Buy)
            // 2. Owned but not equipped: Yellow (Equip)
            // 3. Equipped: Gray (In Use)
            let btnClass = "";
            let btnText = "";

            if (!isOwned) {
                btnClass = "bg-yellow-400 text-yellow-900 shadow-sm";
                btnText = "êµ¬ë§¤";
            } else if (isOwned && !isEquipped) {
                btnClass = "bg-yellow-400 text-yellow-900 shadow-sm";
                btnText = "ì¥ì°©";
            } else {
                btnClass = "bg-gray-200 text-gray-400 cursor-default";
                btnText = "ì¥ì°©ì¤‘";
            }

            div.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <span class="text-4xl">${item.icon}</span>
                        <div>
                            <p class="font-bold text-gray-800">${item.name}</p>
                            <div class="flex flex-col space-y-0.5">
                                <span class="text-[10px] font-bold text-blue-500">ìŠ¹ë¥  +${winBonus}%</span>
                                <span class="text-[10px] font-bold text-red-400">ë¶„ë…¸ ì €í•­ ${item.wrathResistance}%</span>
                            </div>
                            <p class="text-xs text-gray-400 font-bold mt-1">${isOwned ? 'ë³´ìœ ì¤‘' : item.price + ' ì½”ì¸'}</p>
                        </div>
                    </div>
                    <button onclick="${isEquipped ? '' : (isOwned ? `equip(${item.id})` : `buy(${item.id})`)}"
                            class="px-5 py-2 rounded-2xl text-sm font-black transition-all ${btnClass}">
                        ${btnText}
                    </button>
                `;
            shopContainer.appendChild(div);
        });

        const modal = document.getElementById('shop-modal');
        if (modal.classList.contains('hidden')) {
            toggleModal('shop-modal');
        }
    }

    function buy(id) {
        const item = state.inventory.find(i => i.id === id);
        if (state.coins >= item.price) {
            state.coins -= item.price;
            state.ownedGloves.push(id);
            saveGame();
            updateUI();
            openShop();
        } else {
            toast("ì½”ì¸ì´ ë¶€ì¡±í•´ìš”!");
        }
    }

    function equip(id) {
        state.equippedGloveId = id;
        saveGame();
        updateUI();
        openShop(); // Refresh shop to show "In Use" state
    }

    function toast(msg) {
        const box = document.createElement('div');
        box.className = "fixed bottom-24 left-1/2 -translate-x-1/2 bg-gray-900/90 text-white px-8 py-4 rounded-3xl shadow-2xl z-[300] animate-slide-up text-sm font-bold backdrop-blur-sm";
        box.innerText = msg;
        document.body.appendChild(box);
        setTimeout(() => box.remove(), 2500);
    }
</script>
</body>
</html>